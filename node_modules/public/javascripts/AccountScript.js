// DEBUG: Once we update one section, we cannot update the others
// until we've refreshed the page.

// Event listener for loading the account page
document.addEventListener("DOMContentLoaded", function(event) {
  $.get("http://localhost:3000/account")
  .then(function(accountPage){
    document.documentElement.innerHTML = accountPage;
  })
  .then(whenAccountPageLoads);
}); // End of event listener for loading of account page

// Script for when account page loads
var whenAccountPageLoads = function(){
  loadLocalCartInfo();
  loadMenuFromServer();
  loadBasicUserInfo();

  if(Cookies.getJSON("userCredentials") === undefined){
    $("#login-form").on("click", "#login-btn", loginUser);
  }
  else{
    loadAccountFromServer()
    .then(function(account){
      writeUserInfoToForm(account, document);
      $("#logout-btn").click(logoutUser);

      $("#name-form").on("click", ".update-btn", function(event){
        event.preventDefault();
        window.account = updateAccountName(window.account, $("#name-fields"))
        .then(function(account){
          alert("Name updated!");
          return account;
        });
      });

      $("#contact-form").on("click", ".update-btn", function(event){
        event.preventDefault();
        window.account = updateAccountContact(window.account, $("#contact-fields"))
        .then(function(account){
          alert("Contact information updated!");
          return account;
        });
      });

      $("#mailing-address-form").on("click", ".update-btn", function(event){
        event.preventDefault();
        window.account = updateAccountMailingAddr(window.account, $("#mailing-address-fields"))
        .then(function(account){
          alert("Mailing address updated!");
          return account;
        });
      });

      $("#billing-address-form").on("click", ".update-btn", function(event){
        event.preventDefault();
        window.account = updateAccountBillingAddr(window.account, $("#billing-address-fields"))
        .then(function(account){
          alert("Billing address updated!");
          return account;
        });
      });

      $("#payment-form").on("click", ".update-btn", function(event){
        event.preventDefault();
        window.account = updateAccountCreditCard(window.account, $("#payment-fields"))
        .then(function(account){
          alert("Payment information updated!");
          return account;
        });
      });

      $("#password-form").on("click", ".update-btn", function(event){
        event.preventDefault();
        window.account = updateAccountPassword(window.account, $("#password-fields"))
        .then(function(account){
          alert("Password updated!");
          return account;
        });
      });
    });
  }
} // End of script for when account page loads
