
// ADD: We need it to direct the user to a
// confirmation page.
var processOrder = function(event){

  var postOrderedItemsToAccount = function(account){
    // Add the order to a database and link it to this account.
    for(var i = 0; i < window.globalCart["items"].length; i++){
      processOrderedItem(account["_id"], window.globalCart["items"][i]);
    }
  };

  //validateClientInfo(document);
  alert("We are about to submit.");
  //document.getElementById("clientForm").submit();

  if(window.account != undefined){
    updateAccount(window.account, document)
    .then(function(account){
      window.account = account;
      return window.account;
    })
    .then(postOrderedItemsToAccount);
  }
  else{
    createAccount(document)
    .then(function(account){
      window.account = account;
      Cookies.set("userCredentials", JSON.stringify({email: account.email, password: doc.getElementsByName("password")[0].value}));
      return window.account;
    })
    .then(postOrderedItemsToAccount);
  }

  alert("We submitted.");
}

var processOrderedItem = function(userId, cartItem){
  $.post("http://localhost:3000/order",
         {userId: userId,
          itemId: cartItem["_id"],
          quantity: cartItem["quantity"],
          unitPrice: cartItem["unitPrice"],
          date: "",
          fullfilled: false});
}
